{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "839c02d2-965c-42dd-8579-a5586a428178",
            "version": "KqlParameterItem/1.0",
            "name": "Tab",
            "type": 11,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\"PAN-OS Firewall Logs\", \"Prisma Access Traffic Logs\", \"Prisma Access URL Logs\", \"Azure Firewall Traffic\"]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "PAN-OS Firewall Logs"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Tab Selector"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "<CustomTable>\n| where DeviceVendor == \"Palo Alto Networks\"\n| where Activity == \"TRAFFIC\"\n| where SourceIP contains \"{Source_IP}\"\n| where DestinationIP contains \"{Destination_IP}\"\n| where \"{Destination_Port:label}\"==\"All\" or DestinationPort in ({Destination_Port})\n| where \"{Device_Action:label}\"==\"All\" or DeviceAction in ({Device_Action})\n| where \"{Device_Name:label}\"==\"All\" or DeviceName in ({Device_Name})\n| where \"{Rule:label}\"==\"All\" or Rule in ({Rule})\n| summarize count() by bin(TimeGenerated, 5m), DeviceAction",
              "size": 1,
              "title": "Traffic by Action",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "areachart"
            },
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "<CustomTable>\n| where DeviceVendor == \"Palo Alto Networks\"\n| where Activity == \"TRAFFIC\"\n| where SourceIP contains \"{Source_IP}\"\n| where DestinationIP contains \"{Destination_IP}\"\n| where \"{Destination_Port:label}\"==\"All\" or DestinationPort in ({Destination_Port})\n| where \"{Device_Action:label}\"==\"All\" or DeviceAction in ({Device_Action})\n| where \"{Device_Name:label}\"==\"All\" or DeviceName in ({Device_Name})\n| where \"{Rule:label}\"==\"All\" or Rule in ({Rule})\n| project TimeGenerated, Activity, Action = DeviceAction, Application = ApplicationProtocol, SourceIP, DestinationIP, DestPort = DestinationPort, Protocol, DeviceName, Reason, DeviceEventCategory, Rule, TotalBytes\n| order by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Palo Alto Firewall Traffic Log",
              "timeContextFromParameter": "TimeRange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              }
            },
            "name": "Traffic Log"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "PAN-OS Firewall Logs"
      },
      "name": "Group - PAN-OS Firewall Logs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "<CustomTable>\n| where LogType_s == \"TRAFFIC\"\n| summarize count() by bin(TimeGenerated, 10m), Action_s\n| render areachart",
              "size": 1,
              "title": "24 hour Prisma Access Traffic",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "areachart"
            },
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "<CustomTable>\n| where LogType_s == \"TRAFFIC\"\n| where SourceAddress_s contains \"{Source_IP}\"\n| where DestinationAddress_s contains \"{Destination_IP}\"\n| where \"{Destination_Port:label}\"==\"All\" or DestinationPort_d in ({Destination_Port})\n| where \"{Device_Action:label}\"==\"All\" or Action_s in ({Device_Action})\n| where \"{Source_User:label}\"==\"All\" or SourceUser_s contains \"{Source_User}\"\n| project TimeGenerated, User = SourceUser_s, App = Application_s, Action = Action_s, Protocol = Protocol_s, Source = SourceAddress_s, Destination = DestinationAddress_s, DestPort = DestinationPort_d, Service = DeviceName_s, Reason = SessionEndReason_s, Category = URLCategory_s, Rule = Rule_s, TotalBytes = Bytes_d",
              "size": 0,
              "showAnalytics": true,
              "title": "Palo Alto Prisma Access Traffic Log",
              "timeContextFromParameter": "TimeRange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              }
            },
            "name": "Traffic Log"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Prisma Access Traffic Logs"
      },
      "name": "Group - Prisma Access Traffic Logs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "<CustomTable>\n| where SourceAddress_s contains \"{Source_IP}\"\n| where URL_s has \"{Destination_URL}\"\n| where \"{Destination_Port:label}\"==\"All\" or DestinationPort_d in ({Destination_Port})\n| where \"{Device_Action:label}\"==\"All\" or Action_s in ({Device_Action})\n| where \"{Source_User:label}\"==\"All\" or SourceUser_s contains \"{Source_User}\"\n| project TimeGenerated, User = SourceUser_s, URL = URL_s, App = Application_s, Action = Action_s, Protocol = Protocol_s, Source = SourceAddress_s, Destination = DestinationAddress_s, DestPort = DestinationPort_d, Service = DeviceName_s, Category = URLCategory_s, Rule = Rule_s",
              "size": 0,
              "showAnalytics": true,
              "title": "Palo Alto Prisma Access URL Log",
              "timeContextFromParameter": "TimeRange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              }
            },
            "name": "URL Log"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Prisma Access URL Logs"
      },
      "name": "Group - Prisma Access URL Logs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AZFWNetworkRule\n| where SourceIp contains \"{Source_IP}\"\n| where DestinationIp contains \"{Destination_IP}\"\n| where \"{Destination_Port:label}\"==\"All\" or DestinationPort in ({Destination_Port})\n| where \"{Action:label}\"==\"All\" or Action in ({Action})\n| summarize count() by bin(TimeGenerated, 5m), Action",
              "size": 1,
              "title": "Azure Firewall Traffic Log",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "areachart"
            },
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AZFWNetworkRule\n| where SourceIp contains \"{Source_IP}\"\n| where DestinationIp contains \"{Destination_IP}\"\n| where \"{Destination_Port:label}\"==\"All\" or DestinationPort in ({Destination_Port})\n| where \"{Action:label}\"==\"All\" or Action in ({Action})\n| project TimeGenerated, Action, SourceIp, DestinationIp, DestinationPort, Protocol, Policy, Type, Rule\n| order by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Traffic Log",
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              }
            },
            "name": "Traffic Log"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Azure Firewall Traffic"
      },
      "name": "Group - Azure Firewall Traffic"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/<subscription-id>/resourcegroups/<resource-group>/providers/microsoft.operationalinsights/workspaces/<workspace-name>"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
